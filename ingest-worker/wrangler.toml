name = "flare360-ingest"
main = "src/index.ts"
compatibility_date = "2024-10-01"

account_id = "1e54c42267499cd9093c467c8b5517d1"

[[d1_databases]]
binding = "DB"
database_name = "dcom360-db"
database_id = "aae8e15b-bb6a-4f16-9e2d-e63ec2ae9c20"
migrations_dir = "../worker/migrations"

[[kv_namespaces]]
binding = "CACHE"
id = "46818e79770044efa2e863ca0b0f465a"

[ai]
binding = "AI"

[vars]
INGEST_TOKEN = "dev-token-123" # set via `wrangler secret put INGEST_TOKEN` in production
GDACS_RSS_URL = "https://www.gdacs.org/XML/RSS.xml"
RELIEFWEB_RSS_URL = "https://reliefweb.int/disasters/rss.xml"
USGS_RSS_URL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.atom"
NOAA_CAP_RSS_URL = "https://alerts.weather.gov/cap/us.atom"
NASA_FIRMS_MAP_KEY = "a7d8b367baa77d5697b0f6768d75f349"

[env.staging]
[env.staging.vars]
INGEST_TOKEN = "dev-token-123"
GDACS_RSS_URL = "https://www.gdacs.org/XML/RSS.xml"
RELIEFWEB_RSS_URL = "https://reliefweb.int/disasters/rss.xml"
USGS_RSS_URL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.atom"
NOAA_CAP_RSS_URL = "https://alerts.weather.gov/cap/us.atom"
NASA_FIRMS_MAP_KEY = "a7d8b367baa77d5697b0f6768d75f349"
[[env.staging.d1_databases]]
binding = "DB"
database_name = "dcom360-db"
database_id = "aae8e15b-bb6a-4f16-9e2d-e63ec2ae9c20"
[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "46818e79770044efa2e863ca0b0f465a"
[env.staging.ai]
binding = "AI"

[env.production]
# Use Cloudflare Secret for INGEST_SECRET in production (do not set as plain var)
[env.production.vars]
GDACS_RSS_URL = "https://www.gdacs.org/XML/RSS.xml"
RELIEFWEB_RSS_URL = "https://reliefweb.int/disasters/rss.xml"
USGS_RSS_URL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.atom"
NOAA_CAP_RSS_URL = "https://alerts.weather.gov/cap/us.atom"
INGEST_TOKEN = ""
NASA_FIRMS_MAP_KEY = "a7d8b367baa77d5697b0f6768d75f349"
[[env.production.d1_databases]]
binding = "DB"
database_name = "dcom360-db"
database_id = "aae8e15b-bb6a-4f16-9e2d-e63ec2ae9c20"
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "46818e79770044efa2e863ca0b0f465a"
[env.production.ai]
binding = "AI"

[triggers]
crons = ["*/3 * * * *"]
